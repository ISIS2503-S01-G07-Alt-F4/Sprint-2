{% extends 'base.html' %}

{% block title %}
  {% if rol == "JefeBodega" or rol == "Operario" %}
    Crear Producto
  {% else %}
    Acceso Restringido
  {% endif %}
{% endblock %}

{% block content %}
{% if rol == "JefeBodega" or rol == "Operario" %}
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow">
        <div class="card-header text-center bg-primary text-white">
          <h4 class="mb-0">Crear Producto</h4>
          {% if bodega_actual %}
            <small class="text-light">Bodega: {{ bodega_actual.ciudad }} - {{ bodega_actual.direccion }}</small>
          {% endif %}
        </div>
        <div class="card-body">
          <!-- Mostrar solo el último mensaje -->
          {% if messages %}
            {% for message in messages %}
              {% if forloop.last %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
              {% endif %}
            {% endfor %}
          {% endif %}
          
          {% if form %}
            <form method="POST">
              {% csrf_token %}
              {{ form.as_p }}
              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-success">Crear Producto</button>
                <button type="button" class="btn btn-outline-secondary" onClick="window.location.href='/'">Volver</button>
              </div>
            </form>
          {% else %}
            <div class="alert alert-warning text-center">
              {% if rol == "Operario" %}
                <h5>Debes seleccionar una bodega</h5>
                <p>Utiliza el selector de bodegas en el menú superior para elegir en cuál bodega trabajar.</p>
              {% else %}
                <h5>No tienes una bodega asignada</h5>
                <p>Contacta al administrador para que te asigne una bodega.</p>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
{% else %}
  {% include 'acceso_denegado.html' with mensaje="Solo los Jefes de Bodega y Operarios pueden crear productos." mostrar_boton_inicio=True %}
{% endif %}
{% endblock %}